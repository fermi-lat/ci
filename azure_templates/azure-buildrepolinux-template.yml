parameters:
  repo: ''

jobs:

- job: buildRepoLinux
  displayName: 'Compile Package - Linux'
  timeoutInMinutes: 150
  pool:
    vmImage: 'ubuntu-latest'
  steps:
  # Manually adding conda to the PATH is a step required by Microsoft
  - bash: echo "##vso[task.prependpath]$CONDA/bin"
    displayName: 'Add conda to PATH'
  - bash: |
      git clone --recurse-submodules https://github.com/fermi-lat/ScienceTools.git
      rm -rf src/${{ parameters.repo }}
      git clone https://github.com/fermi-lat/${{ parameters.repo }} src/${{ parameters.repo }}
    displayName: 'Clone Repository'
  - bash: |
      conda env create -n fermi-dev -f environments/fermitools-develop-linux.yml
      conda activate fermi-dev
    displayName: 'Setup Build environment'
  - bash: |
      cmake -S . -B RelWithDebInfo -DCMAKE_BUILD_TYPE=RelWithDebInfo -DCMAKE_INSTALL_PREFIX=$CONDA_PREFIX -DCMAKE_PREFIX+PATH=$CONDA_PREFIX
      cmake --build RelWithDebInfo --parallel --target=${{ parameters.repo }}
    displayName: 'Compile Package'
